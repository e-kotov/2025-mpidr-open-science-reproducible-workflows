{
  "hash": "23730f7247f4e4851a7d26d1d7846839",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"2. Building analysis pipelines with `targets`\"\nfrom: markdown+emoji\ncode-annotations: hover\neval: false\nnumber-sections: true\n---\n\n\n\n\n[Skip to exercise \\>\\>](#exercise)\n\n# The `targets` package {#targets}\n\n## What does the `targets` package do?\n\nThe `{targets}` package is a framework for building data processing, analysis and visualization pipelines in R. It helps you structure your code by splitting it onto logical chunks that follow each other in a logical order. `{targets}` also manages the intermediate results of each step, so you do not have to do it manually. It also minimizes the time it takes to update the results if any step changes, be it some change in the source data, or in the code. `{targets}` knows which steps are up-to-date, and which are not, and only runs the steps that are outdated.\n\nConsider the following minimal example:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(targets)\n\nlist(\n  # 1. Load the mtcars dataset.\n  tar_target(\n    name = mtcars_data,\n    command = data(mtcars)\n  ),\n\n  # 2. Compute the mean of the mpg column.\n  tar_target(\n    name = mpg_mean,\n    command = mean(mtcars_data$mpg)\n  ),\n\n  # 3. Create a histogram plot of mpg using base R.\n  tar_target(\n    name = hist_mpg,\n    packages = c(\"ggplot2\"),\n    command = {\n      ggplot(mtcars_data, aes(x = mpg)) +\n        geom_histogram(binwidth = 1) +\n        labs(title = \"Histogram of MPG\", x = \"Miles Per Gallon\", y = \"Count\")\n    }\n  )\n)\n```\n:::\n\n\n\n\nThis script has three steps. It loads the data, computes a simple statistic, and creates a plot. To run this pipeline with `targets` you would need to save this script to the `_targets.R` file in the root of the project directory and run `targets::tar_make()` in R console.\n\n<details>\n<summary>Code to try `targets` in R console interactively</summary>\n\nTo quickly run the pipeline above in R console without setting up `targets` properly and creating an R script file, you can use the code below, that can be pasted in to the R console (and it will make the pipeline run in a temporary directory):\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntar_dir({\n  # runs the code in a temporary directory\n  tar_script(\n    {\n      library(targets)\n\n      list(\n        # 1. Load the mtcars dataset.\n        tar_target(\n          name = mtcars_data,\n          command = data(mtcars)\n        ),\n\n        # 2. Compute the mean of the mpg column.\n        tar_target(\n          name = mpg_mean,\n          command = mean(mtcars_data$mpg)\n        ),\n\n        # 3. Create a histogram plot of mpg using base R.\n        tar_target(\n          name = hist_mpg,\n          packages = c(\"ggplot2\"),\n          command = {\n            ggplot(mtcars_data, aes(x = mpg)) +\n              geom_histogram(binwidth = 1) +\n              labs(\n                title = \"Histogram of MPG\",\n                x = \"Miles Per Gallon\",\n                y = \"Count\"\n              )\n          }\n        )\n      )\n    },\n    ask = FALSE\n  )\n\n  # Run all targets defined in the pipeline.\n  tar_make()\n})\n```\n:::\n\n\n\n\nYou will get output similar to this:\n\n```r\n▶ dispatched target mtcars_data\n● completed target mtcars_data [0 seconds, 1.225 kilobytes]\n▶ dispatched target plot_mpg\n● completed target plot_mpg [0.011 seconds, 65 bytes]\n▶ dispatched target mpg_mean\n● completed target mpg_mean [0 seconds, 52 bytes]\n▶ ended pipeline [0.059 seconds]\n```\n\nIt would mean that all steps have been executed successfully.\n\nSimilarly, if you replace `tar_make()` with `tar_visnetwork()`, you will get a visualization of the pipeline:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntar_dir({\n  # runs the code in a temporary directory\n  tar_script(\n    {\n      library(targets)\n\n      list(\n        # 1. Load the mtcars dataset.\n        tar_target(\n          name = mtcars_data,\n          command = data(mtcars)\n        ),\n\n        # 2. Compute the mean of the mpg column.\n        tar_target(\n          name = mpg_mean,\n          command = mean(mtcars_data$mpg)\n        ),\n\n        # 3. Create a histogram plot of mpg using base R.\n        tar_target(\n          name = hist_mpg,\n          packages = c(\"ggplot2\"),\n          command = {\n            ggplot(mtcars_data, aes(x = mpg)) +\n              geom_histogram(binwidth = 1) +\n              labs(\n                title = \"Histogram of MPG\",\n                x = \"Miles Per Gallon\",\n                y = \"Count\"\n              )\n          }\n        )\n      )\n    },\n    ask = FALSE\n  )\n\n  # Run all targets defined in the pipeline.\n  tar_visnetwork()\n})\n```\n:::\n\n\n\n\nYou would get output similar to the one in the @fig-mtcars-visnet below.\n\n![\"Pipeline visualization example\"](media/images/mtcars-visnet.png){#fig-mtcars-visnet width=80%}\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}